app-id: com.tercad.tlum
runtime: org.gnome.Platform
runtime-version: "45"
sdk: org.gnome.Sdk
command: tlum
separate-locales: false
finish-args:
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=network
  - --share=ipc
  - --device=dri
  - --env=DISPLAY=$DISPLAY
  - --env=XAUTHORITY=$XAUTHORITY
  - --env=WAYLAND_DISPLAY=$WAYLAND_DISPLAY
  - --env=KIVY_WINDOW=sdl2
  - --env=KIVY_GL_BACKEND=gl
  - --filesystem=home
modules:
  - name: portaudio
    buildsystem: autotools
    sources:
      - type: archive
        url: https://files.portaudio.com/archives/pa_stable_v190700_20210406.tgz
        sha256: 47efbf42c77c19a05d22e627d42873e991ec0c1357219c0d74ce6a2948cb2def

  - name: zenity
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/zenity/3.41/zenity-3.41.0.tar.xz
        sha256: 19b676c3510e22badfcc3204062d432ba537402f5e0ae26128c0d90c954037e1

  - name: Tlum
    buildsystem: simple
    only-arches:
      - x86_64
    build-commands:
      - mkdir -p Tlum
      - tar -xf tlum_Linux.tar.gz -C Tlum
      - cp -r Tlum /app/Tlum
      - chmod +x /app/Tlum/tlum
      - mkdir -p /app/bin
      - ln -s /app/Tlum/tlum /app/bin/tlum
      - export XDG_DATA_HOME="/var/lib/flatpak/exports/share:$XDG_DATA_HOME"
      - export XDG_DATA_DIRS="/var/lib/flatpak/exports/share:$XDG_DATA_DIRS"
      - install -Dm644 com.tercad.tlum.svg /app/share/icons/hicolor/scalable/apps/com.tercad.tlum.svg
      - install -Dm644 /app/Tlum/com.tercad.tlum.desktop /app/share/applications/com.tercad.tlum.desktop
      - install -Dm644 /app/Tlum/com.tercad.tlum.metainfo.xml /app/share/appdata/com.tercad.tlum.metainfo.xml
    sources:
      - type: file
        url: https://github.com/lyskouski/app-language/releases/download/v{VERSION}/tlum_Linux.tar.gz
        sha256: "{SHA256}"
      - type: file
        path: com.tercad.tlum.metainfo.xml
