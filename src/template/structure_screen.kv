# Copyright 2025 The terCAD team. All rights reserved.
# Use of this source code is governed by a CC BY-NC-ND 4.0 license that can be found in the LICENSE file.

<StructureScreen>:
    BoxLayout:
        orientation: "vertical"
        ActionBar:
            hidden: app.is_mobile
            # size_hint_y: 0 if app.is_mobile else None
            opacity: 1.0 if not app.is_mobile else 0
            height: '48dp' if not app.is_mobile else 0
            ActionView:
                use_separator: True
                ActionPrevious:
                    with_previous: True
                    on_release: app.next_screen('main_screen')
                    title: app._('edit_structure', app.locale)
        Widget:
            size_hint_y: dp(0.04)
        RecycleView:
            id: structure_view
            viewclass: "StructureWidget"
            RecycleBoxLayout:
                default_size: None, dp(48)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: "vertical"
        Widget:
            size_hint_y: dp(0.08)

        ActionBar:
            hidden: False if app.is_mobile else True
            # size_hint_y: None if app.is_mobile else 0
            opacity: 1.0 if app.is_mobile else 0
            height: '48dp' if app.is_mobile else 0
            ActionView:
                use_separator: True
                ActionPrevious:
                    with_previous: True
                    on_release: app.next_screen('main_screen')
                    title: app._('edit_structure', app.locale)

<StructureWidget@BoxLayout>:
    orientation: "horizontal"
    Widget:
        size_hint_x: dp(0.04)
    Widget:
        size_hint_x: dp(root.indent) if root.indent else dp(0.01)
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Line:
                points: (self.right - dp(5), self.top - dp(20), self.right, self.top - dp(20))
                width: 0.25
            Line:
                points: (self.right - dp(5), self.top, self.right - dp(5), self.top - dp(20))
                width: 0.25
    Button:
        text: app._('button_collapse' if root.is_expanded else 'button_expand', app.locale)
        disabled: False if root.source else True
        opacity: 1.0 if root.source else 0
        size_hint_x: dp(0.5 if root.source else 0.01)
        on_release:
            root.collapse() if root.is_expanded else root.expand()
    Label:
        text: '[b]' + root.text + '[/b]\n' + root.source
        markup: True
        halign: "left"
        valign: "middle"
        text_size: self.size
    Button:
        text: app._('button_edit', app.locale)
        size_hint_x: dp(0.5)
        on_release:
            app.next_screen('structure_update_screen', root)
    Button:
        text: app._('button_update', app.locale)
        disabled: False if root.store_path else True
        opacity: 1.0 if root.store_path else 0
        size_hint_x: dp(0.5 if root.store_path else 0.01)
        on_release:
            app.next_screen('store_update_screen', root)
    Widget:
        size_hint_x: dp(0.05)
